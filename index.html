<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ぶりゲーム（石川の出世魚）- プロトタイプ</title>
  <link rel="stylesheet" href="src/style.css" />
</head>
<body>
  <div class="wrap">
    <div class="left">
      <div class="title">ぶりゲーム（ご当地版）</div>
      <div class="subtitle">石川の出世魚：<b>魚卵 → 稚魚 → こぞくら → ふくらぎ → がんど → ぶり → 刺身 → 寿司 → ぶり大根 → 鰤しゃぶ</b></div>

      <div class="hud">
        <div class="card">
          スコア<br><span id="score" class="big">0</span>
        </div>
        <div class="card">
          次に落ちる：<br>
          <div id="nextBox" style="display:flex;align-items:center;gap:8px;margin-top:4px"></div>
        </div>
      </div>

      <div class="controls">
        <div>操作：PCは <span class="kbd">←</span><span class="kbd">→</span> で移動 / <span class="kbd">スペース</span> でドロップ / <span class="kbd">R</span> でリセット。スマホは「画面ドラッグで移動・離してドロップ」。</div>
        <button id="dropBtn" class="blink">スペースでドロップ</button>
        <div class="levels" id="legend"></div>
        <button id="resetBtn" class="secondary">リセット</button>
        <div class="audio">
          <button id="bgmToggle" class="secondary">BGM: ON</button>
          <label style="display:flex;align-items:center;gap:8px">
            音量 <input id="bgmVolume" type="range" min="0" max="1" step="0.01" value="0.35" style="flex:1" />
          </label>
        </div>
        <div class="ocean">
          <button id="flowInfo" class="secondary">海流の解説</button>
        </div>
        <div class="info-block">
          <div class="info-title">海流タイム</div>
          <p>しばらく遊んでいると、ときどき「対馬海流」または「リマン海流」が9秒ほど発生します。その間は流れの向きに合わせて玉がゆっくり右または左へ引っ張られます。</p>
          <ul>
            <li>対馬海流: 暖流。右方向に押し流され、積み重なった玉をほぐしやすくなります。</li>
            <li>リマン海流: 寒流。左方向へ引っ張られ、配置を立て直すチャンスになります。</li>
          </ul>
          <div class="info-title">ぶりおこし</div>
          <p>合体が祭り状態になる12秒間のボーナス。次に落ちる玉がすべて「ぶり」になり、大きな連鎖のチャンスが生まれます。</p>
        </div>
      </div>
    </div>

    <div class="stage">
      <canvas id="game" width="720" height="960" aria-label="ゲームフィールド"></canvas>
      <div id="fx" class="fx" aria-hidden="true"></div>
    </div>
  </div>

  <div class="gameover" id="flowInfoOverlay" aria-hidden="true" style="display:none">
    <div class="dialog">
      <h2>日本海の海流と鰤</h2>
      <p>
        日本海では南から北へ流れる暖流「対馬海流」と、北から南へ流れる寒流「リマン海流」が季節ごとに勢力を変えながら行き交います。
        ゲームでもこの2つの海流がランダムに発生し、流れの向きに合わせて玉がゆっくり横移動します。
      </p>
      <ul>
        <li><b>対馬海流</b>（暖流）: 右向きの穏やかな流れ。玉が右へ押し出されてスペースができやすくなります。</li>
        <li><b>リマン海流</b>（寒流）: 左向きの冷たい流れ。玉を左に寄せ、積み直すきっかけになります。</li>
      </ul>
      <div class="row">
        <button id="flowClose">閉じる</button>
      </div>
    </div>
  </div>

  <div class="gameover" id="gameover">
    <div class="dialog">
      <h2>ゲームオーバー</h2>
      <p>海があふれました…！ スコア：<b id="finalScore">0</b></p>
      <div class="share-block">
        <div class="share-preview">
          <img id="sharePreview" alt="プレーエリアのスクリーンショット" />
        </div>
        <button id="shareBtn">結果をシェア</button>
        <div class="sns-buttons" aria-label="SNSでシェア">
          <a id="shareX" class="sns-btn sns-x" href="#" target="_blank" rel="noopener">Xでシェア</a>
        </div>
        <p id="shareStatus" class="share-status" aria-live="polite"></p>
      </div>
      <div class="row">
        <button id="again">もう一度</button>
        <button id="quit" class="secondary">閉じる</button>
      </div>
    </div>
  </div>

  <script src="src/game.js"></script>
</body>
</html>
